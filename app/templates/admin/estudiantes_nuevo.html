{% extends "admin/base_admin.html" %}

{% block title %}Nuevo Estudiante - EduControl{% endblock %}

{% block page_title %}Nuevo Estudiante{% endblock %}

{% block breadcrumb %}
<i class="fas fa-chevron-right"></i>
<span>Usuarios</span>
<i class="fas fa-chevron-right"></i>
<span><a href="{{ url_for('admin.estudiantes') }}" class="text-white-50 text-decoration-none">Estudiantes</a></span>
<i class="fas fa-chevron-right"></i>
<span>Nuevo</span>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Indicador de progreso -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Progreso del Registro</h6>
                    <span class="text-muted">Paso <span id="pasoActual">1</span> de 3</span>
                </div>
                <div class="progress mt-2" style="height: 8px;">
                    <div class="progress-bar" role="progressbar" style="width: 33%" id="barraProgreso"></div>
                </div>
                <div class="d-flex justify-content-between mt-2">
                    <small class="text-primary fw-bold" id="etiqueta1">Datos Básicos</small>
                    <small class="text-muted" id="etiqueta2">Información Académica</small>
                    <small class="text-muted" id="etiqueta3">Datos Adicionales</small>
                </div>
            </div>
        </div>

        <!-- Formulario Multi-paso -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-user-plus me-2"></i>
                    Registro de Nuevo Estudiante
                </h5>
            </div>
            <div class="card-body">
                <form id="nuevo-estudiante-form" novalidate>
                    <!-- PASO 1: DATOS BÁSICOS -->
                    <div class="paso-form" id="paso1">
                        <div class="form-header-section">
                            <h6>
                                <i class="fas fa-user"></i>
                                Información Personal
                            </h6>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="nombres" class="form-label">
                                        <i class="fas fa-user"></i>
                                        Nombres <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-with-validation">
                                        <input type="text" class="form-control" id="nombres" required
                                               placeholder="Ingrese los nombres">
                                        <span class="validation-icon"></span>
                                    </div>
                                    <div class="invalid-feedback">
                                        Por favor ingrese los nombres del estudiante.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="documento" class="form-label">
                                        <i class="fas fa-hashtag"></i>
                                        Número de Documento <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-with-validation">
                                        <input type="text" class="form-control" id="documento" required
                                               placeholder="Ingrese el número de documento">
                                        <span class="validation-icon"></span>
                                    </div>
                                    <div class="invalid-feedback">
                                        Por favor ingrese un número de documento válido.
                                    </div>
                                    <div id="documento-exists" class="warning-alert" style="display: none;">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        Este documento ya está registrado para: Luis Cardenas
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="apellidos" class="form-label">
                                        <i class="fas fa-user"></i>
                                        Apellidos <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-with-validation">
                                        <input type="text" class="form-control" id="apellidos" required
                                               placeholder="Ingrese los apellidos">
                                        <span class="validation-icon"></span>
                                    </div>
                                    <div class="invalid-feedback">
                                        Por favor ingrese los apellidos del estudiante.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="fecha_nacimiento" class="form-label">
                                        <i class="fas fa-calendar"></i>
                                        Fecha de Nacimiento <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-with-validation">
                                        <input type="date" class="form-control" id="fecha_nacimiento" required
                                               oninput="limitarAnio(this)">
                                        <span class="validation-icon"></span>
                                    </div>
                                    <div class="invalid-feedback">
                                        Por favor ingrese una fecha de nacimiento válida.
                                    </div>
                                    <small class="form-text text-muted">
                                        Edad calculada: <span id="edad-calculada">--</span> años
                                    </small>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="tipo_documento" class="form-label">
                                        <i class="fas fa-id-card"></i>
                                        Tipo de Documento <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-with-validation">
                                        <select class="form-select" id="tipo_documento" required>
                                            <option value="">Seleccionar tipo</option>
                                            <option value="TI">Tarjeta de Identidad</option>
                                            <option value="CC">Cédula de Ciudadanía</option>
                                            <option value="CE">Cédula de Extranjería</option>
                                            <option value="RC">Registro Civil</option>
                                            <option value="PA">Pasaporte</option>
                                        </select>
                                        <span class="validation-icon"></span>
                                    </div>
                                    <div class="invalid-feedback">
                                        Por favor seleccione el tipo de documento.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="genero" class="form-label">
                                        <i class="fas fa-venus-mars"></i>
                                        Género <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-with-validation">
                                        <select class="form-select" id="genero" required>
                                            <option value="">Seleccionar género</option>
                                            <option value="M">Masculino</option>
                                            <option value="F">Femenino</option>
                                            <option value="O">Otro</option>
                                        </select>
                                        <span class="validation-icon"></span>
                                    </div>
                                    <div class="invalid-feedback">
                                        Por favor seleccione el género.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="telefono" class="form-label">
                                        <i class="fas fa-phone"></i>
                                        Teléfono
                                    </label>
                                    <div class="input-with-validation">
                                        <input type="tel" class="form-control" id="telefono"
                                               placeholder="Ej: 3001234567">
                                        <span class="validation-icon"></span>
                                    </div>
                                    <div class="invalid-feedback">
                                        Por favor ingrese un número de teléfono válido.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="email" class="form-label">
                                        <i class="fas fa-envelope"></i>
                                        Correo Electrónico
                                    </label>
                                    <div class="input-with-validation">
                                        <input type="email" class="form-control" id="email"
                                               placeholder="estudiante@ejemplo.com">
                                        <span class="validation-icon"></span>
                                    </div>
                                    <div class="invalid-feedback">
                                        Por favor ingrese un correo electrónico válido.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Campos de ubicación -->
                        <div class="location-fields">
                            <div class="form-header-section">
                                <h5 class="mb-0">
                                    <i class="fas fa-map-marked-alt"></i>
                                    Ubicación
                                </h5>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="ciudad" class="form-label">
                                            <i class="fas fa-city"></i>
                                            Ciudad <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-with-validation">
                                            <select class="form-select" id="ciudad" required onchange="cargarBarrios()">
                                                <option value="">Seleccionar ciudad</option>
                                                <option value="Barranquilla">Barranquilla</option>
                                                <option value="Soledad">Soledad</option>
                                            </select>
                                            <span class="validation-icon"></span>
                                        </div>
                                        <div class="invalid-feedback">
                                            Por favor seleccione la ciudad.
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="barrio" class="form-label">
                                            <i class="fas fa-map-marked-alt"></i>
                                            Barrio <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-with-validation">
                                            <select class="form-select" id="barrio" required disabled>
                                                <option value="">Primero seleccione una ciudad</option>
                                            </select>
                                            <span class="validation-icon"></span>
                                        </div>
                                        <div class="invalid-feedback">
                                            Por favor seleccione el barrio.
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label for="direccion" class="form-label">
                                            <i class="fas fa-map-marker-alt"></i>
                                            Dirección <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-with-validation">
                                            <input type="text" class="form-control" id="direccion" required>
                                            <span class="validation-icon"></span>
                                        </div>
                                        <div class="invalid-feedback">
                                            Por favor ingrese la dirección completa.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PASO 2: INFORMACIÓN ACADÉMICA -->
                    <div class="paso-form" id="paso2" style="display: none;">
                        <div class="form-header-section">
                            <h6>
                                <i class="fas fa-graduation-cap"></i>
                                Información Académica
                            </h6>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="grado" class="form-label">
                                        <i class="fas fa-layer-group"></i>
                                        Grado <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-with-validation">
                                        <select class="form-select" id="grado" required>
                                            <option value="">Seleccionar grado</option>
                                            <option value="1">1° - Primero</option>
                                            <option value="2">2° - Segundo</option>
                                            <option value="3">3° - Tercero</option>
                                            <option value="4">4° - Cuarto</option>
                                            <option value="5">5° - Quinto</option>
                                            <option value="6">6° - Sexto</option>
                                            <option value="7">7° - Séptimo</option>
                                            <option value="8">8° - Octavo</option>
                                            <option value="9">9° - Noveno</option>
                                            <option value="10">10° - Décimo</option>
                                            <option value="11">11° - Once</option>
                                        </select>
                                        <span class="validation-icon"></span>
                                    </div>
                                    <div class="invalid-feedback">
                                        Por favor seleccione el grado.
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="seccion" class="form-label">
                                        <i class="fas fa-users"></i>
                                        Sección <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-with-validation">
                                        <select class="form-select" id="seccion" required>
                                            <option value="">Seleccionar sección</option>
                                            <option value="A">A</option>
                                            <option value="B">B</option>
                                            <option value="C">C</option>
                                            <option value="D">D</option>
                                            <option value="E">E</option>
                                        </select>
                                        <span class="validation-icon"></span>
                                    </div>
                                    <div class="invalid-feedback">
                                        Por favor seleccione la sección.
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="fecha_ingreso" class="form-label">
                                        <i class="fas fa-calendar-plus"></i>
                                        Fecha de Ingreso <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-with-validation">
                                        <input type="date" class="form-control" id="fecha_ingreso" required>
                                        <span class="validation-icon"></span>
                                    </div>
                                    <div class="invalid-feedback">
                                        Por favor ingrese la fecha de ingreso.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="institucion_anterior" class="form-label">
                                        <i class="fas fa-school"></i>
                                        Institución Anterior
                                    </label>
                                    <div class="input-with-validation">
                                        <input type="text" class="form-control" id="institucion_anterior"
                                               placeholder="Nombre de la institución anterior">
                                        <span class="validation-icon"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="promedio_anterior" class="form-label">
                                        <i class="fas fa-chart-line"></i>
                                        Promedio Anterior
                                    </label>
                                    <div class="input-with-validation">
                                        <input type="number" class="form-control" id="promedio_anterior" 
                                               min="1" max="5" step="0.1" placeholder="Ej: 4.2">
                                        <span class="validation-icon"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="observaciones_academicas" class="form-label">
                                <i class="fas fa-sticky-note"></i>
                                Observaciones Académicas
                            </label>
                            <div class="input-with-validation">
                                <textarea class="form-control" id="observaciones_academicas" rows="3"
                                          placeholder="Información adicional sobre el rendimiento académico del estudiante"></textarea>
                                <span class="validation-icon"></span>
                            </div>
                        </div>
                    </div>

                    <!-- PASO 3: DATOS ADICIONALES -->
                    <div class="paso-form" id="paso3" style="display: none;">
                        <div class="form-header-section">
                            <h6>
                                <i class="fas fa-clipboard-list"></i>
                                Información Adicional
                            </h6>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="acudiente" class="form-label">
                                        <i class="fas fa-user-shield"></i>
                                        Acudiente Principal
                                    </label>
                                    <div class="input-with-validation">
                                        <select class="form-select" id="acudiente">
                                            <option value="">Seleccionar acudiente</option>
                                            <!-- Se cargarán dinámicamente -->
                                        </select>
                                        <span class="validation-icon"></span>
                                    </div>
                                    <small class="form-text text-muted">
                                        Si no aparece en la lista, 
                                        <a href="#" onclick="abrirModalAcudiente()">registre un nuevo acudiente</a>
                                    </small>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="tipo_sangre" class="form-label">
                                        <i class="fas fa-tint"></i>
                                        Tipo de Sangre
                                    </label>
                                    <div class="input-with-validation">
                                        <select class="form-select" id="tipo_sangre">
                                            <option value="">Seleccionar tipo</option>
                                            <option value="A+">A+</option>
                                            <option value="A-">A-</option>
                                            <option value="B+">B+</option>
                                            <option value="B-">B-</option>
                                            <option value="AB+">AB+</option>
                                            <option value="AB-">AB-</option>
                                            <option value="O+">O+</option>
                                            <option value="O-">O-</option>
                                        </select>
                                        <span class="validation-icon"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="eps" class="form-label">
                                        <i class="fas fa-heart"></i>
                                        EPS
                                    </label>
                                    <div class="input-with-validation">
                                        <input type="text" class="form-control" id="eps"
                                               placeholder="Nombre de la EPS">
                                        <span class="validation-icon"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="contacto_emergencia" class="form-label">
                                        <i class="fas fa-phone-alt"></i>
                                        Contacto de Emergencia
                                    </label>
                                    <div class="input-with-validation">
                                        <input type="tel" class="form-control" id="contacto_emergencia"
                                               placeholder="Teléfono de emergencia">
                                        <span class="validation-icon"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="alergias" class="form-label">
                                <i class="fas fa-exclamation-triangle"></i>
                                Alergias y Condiciones Médicas
                            </label>
                            <div class="input-with-validation">
                                <textarea class="form-control" id="alergias" rows="3"
                                          placeholder="Describa cualquier alergia, condición médica o medicamento que tome"></textarea>
                                <span class="validation-icon"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="observaciones_generales" class="form-label">
                                <i class="fas fa-comments"></i>
                                Observaciones Generales
                            </label>
                            <div class="input-with-validation">
                                <textarea class="form-control" id="observaciones_generales" rows="3"
                                          placeholder="Información adicional relevante sobre el estudiante"></textarea>
                                <span class="validation-icon"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="activo" checked>
                                    <label class="form-check-label fw-bold" for="activo">
                                        <i class="fas fa-toggle-on text-success me-1"></i>
                                        Estudiante Activo
                                    </label>
                                    <small class="form-text text-muted d-block">
                                        El estudiante aparecerá como activo en el sistema
                                    </small>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="notificar_registro">
                                    <label class="form-check-label fw-bold" for="notificar_registro">
                                        <i class="fas fa-bell text-info me-1"></i>
                                        Notificar Registro
                                    </label>
                                    <small class="form-text text-muted d-block">
                                        Enviar notificación de registro al acudiente
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botones de navegación -->
                    <div class="d-flex justify-content-between mt-4">
                        <button type="button" class="btn btn-secondary" id="btnAnterior" onclick="pasoAnterior()" style="display: none;">
                            <i class="fas fa-arrow-left me-2"></i>
                            Anterior
                        </button>
                        
                        <div class="ms-auto">
                            <button type="button" class="btn btn-primary" id="btnSiguiente" onclick="pasoSiguiente()">
                                Siguiente
                                <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                            
                            <button type="submit" class="btn btn-success" id="btnRegistrar" style="display: none;">
                                <i class="fas fa-save me-2"></i>
                                Registrar Estudiante
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal para nuevo acudiente -->
<div class="modal fade" id="modalAcudiente" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-user-plus me-2"></i>
                    Registrar Nuevo Acudiente
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="form-acudiente">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="acudiente_nombres" class="form-label">Nombres</label>
                                <input type="text" class="form-control" id="acudiente_nombres" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="acudiente_apellidos" class="form-label">Apellidos</label>
                                <input type="text" class="form-control" id="acudiente_apellidos" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="acudiente_documento" class="form-label">Documento</label>
                                <input type="text" class="form-control" id="acudiente_documento" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="acudiente_telefono" class="form-label">Teléfono</label>
                                <input type="tel" class="form-control" id="acudiente_telefono" required>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="acudiente_email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="acudiente_email">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="guardarAcudiente()">
                    <i class="fas fa-save me-2"></i>
                    Guardar Acudiente
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script>
    // Variables globales
    let pasoActual = 1;
    const totalPasos = 3;
    let datosEstudiante = {};

    // Función para limitar la entrada del año a 4 dígitos
    function limitarAnio(input) {
        const fecha = input.value;
        const partes = fecha.split('-');
        if (partes.length === 3) {
            const anio = partes[0];
            if (anio.length > 4) {
                // Si el año tiene más de 4 dígitos, mantener solo los primeros 4
                partes[0] = anio.slice(0, 4);
                input.value = partes.join('-');
            }
        }
    }

    // Datos de barrios por ciudad (actualizados al 2025)
    const barriosPorCiudad = {
        "Barranquilla": {
            "Metropolitana": [
                "Buenos Aires",
                "Carrizal",
                "Cevillar",
                "Ciudadela 20 de Julio",
                "El Santuario",
                "Kennedy",
                "La Sierra",
                "La Sierrita",
                "Las Américas",
                "Las Cayenas",
                "Las Gardenias",
                "Las Granjas",
                "Los Continentes",
                "Los Girasoles",
                "San Luis",
                "Santa María",
                "Santo Domingo de Guzmán",
                "Sevilla Real",
                "Siete de Abril",
                "Sinaí",
                "Veinte de Julio",
                "Villa San Carlos",
                "Villa San Pedro I",
                "Villa San Pedro II",
                "Villa Sevilla",
                "Villa Valery"
            ],
            "Suroriente": [
                "Atlántico",
                "Bellarena",
                "Boyacá",
                "Chiquinquirá",
                "El Campito",
                "El Limón",
                "El Parque",
                "El Milagro",
                "José Antonio Galán",
                "La Chinita",
                "La Unión",
                "Las Palmas",
                "San Nicolás",
                "Simón Bolívar"
            ],
            "Suroccidente": [
                "Alfonso López",
                "Bernardo Hoyos",
                "Buena Esperanza",
                "California",
                "Caribe Verde",
                "Ciudad Modesto",
                "Ciudadela de la Salud",
                "Ciudadela de Paz",
                "El Bosque",
                "El Carmen",
                "El Edén",
                "El Pueblo",
                "El Romance",
                "La Ceiba",
                "La Esmeralda",
                "La Gloria",
                "La Libertad",
                "La Manga",
                "La Paz",
                "La Pradera",
                "Las Malvinas",
                "Las Terrazas",
                "Lipaya",
                "Loma Fresca",
                "Los Andes",
                "Los Ángeles I",
                "Los Ángeles II",
                "Los Ángeles III",
                "Los Olivos I",
                "Los Olivos II",
                "Los Pinos",
                "Los Rosales",
                "Lucero",
                "Me Quejo",
                "Nueva Colombia",
                "Nueva Granada",
                "Olaya",
                "Pinar del Río",
                "Por Fin",
                "Pumarejo",
                "San Felipe",
                "San Isidro"
            ],
            "Riomar": [
                "Riomar",
                "Las Tres Ave María",
                "Altamira",
                "Altos de Riomar",
                "San Salvador",
                "Andalucia",
                "Santa Mónica",
                "La Playa",
                "Villa Campestre",
                "Villa Santos"
            ]
        },
        "Soledad": {
            "Norte": [
                "Altos de Jesús",
                "Altos de La Metropolitana",
                "Antonio Nariño",
                "Bella Jerusalén",
                "Bello Horizonte",
                "Cachimbero",
                "Ciudad Bolívar",
                "Ciudad Bonita",
                "Ciudad Camelot",
                "Ciudad Caribe",
                "Ciudad Salitre",
                "Ciudad Transmetro",
                "Ciudadela Metropolitana",
                "Costa Hermosa",
                "Cruz de Mayo",
                "Dieciséis de Junio",
                "Doce de Octubre",
                "El Cabrera",
                "El Carnero",
                "El Centenario",
                "El Cortijo",
                "El Encanto",
                "El Esfuerzo",
                "El Hipódromo",
                "El Manantial",
                "El Oasis",
                "El Pasito",
                "El Triunfo",
                "El Tucán",
                "Jardín de Villa Estadio",
                "Juan Domínguez Romero",
                "La Arboleda",
                "La Bonanza",
                "La Candelaria I",
                "La Candelaria II",
                "La Central",
                "La Esperanza",
                "La Fe",
                "La Floresta I",
                "La Floresta II",
                "La Ilusión",
                "La Inmaculada",
                "La Loma",
                "La María",
                "La Puerta de Oro",
                "La Rivera",
                "La Victoria",
                "Las Colonias I",
                "Las Colonias II",
                "Las Cometas",
                "Las Ferias",
                "Las Gaviotas I",
                "Las Gaviotas II",
                "Las Moras Norte",
                "Las Moras Occidente",
                "Las Moras IV",
                "Las Trinitarias",
                "Linda María I",
                "Linda María II",
                "Los Almendros I",
                "Los Almendros II",
                "Los Almendros III",
                "Los Arrayanes",
                "Los Balcanes",
                "Los Cedros",
                "Los Cerezos",
                "Los Cusules",
                "Los Fundadores",
                "Los Loteros",
                "Los Mangos",
                "Los Robles",
                "Los Robles IV",
                "Los Robles VIII",
                "Los Rosales",
                "Manuela Beltrán",
                "Montecarmelo",
                "Normandía",
                "Nueva Esperanza",
                "Nueva Jerusalén",
                "Nuevo Horizonte I",
                "Nuevo Horizonte II",
                "Nuevo Triunfo",
                "Prado de Soledad",
                "Primero de Mayo",
                "Pumarejo",
                "Renacer",
                "Ríos de Agua Viva",
                "Salamanca",
                "San Antonio",
                "San Bernardo",
                "San Juan Eudes",
                "San Vicente",
                "Siete de Agosto",
                "Sitio Hermoso",
                "Soledad Dos Mil",
                "Tajamar I",
                "Tajamar II",
                "Urbanización Ciudad del Parque",
                "Urbanización El Parque",
                "Urbanización El Río",
                "Urbanización Las Moras",
                "Urbanización María de los Ángeles",
                "Urbanización Parque Muvdi",
                "Urbanización Portal de Jordán",
                "Urbanización Portal de San Antonio",
                "Urbanización Salamanca",
                "Urbanización Santana",
                "Urbanización Sol Real",
                "Urbanización Terranova I",
                "Urbanización Terranova II",
                "Urbanización Villa Mónaco",
                "Urbanización Villa Soledad",
                "Urbanización Villa Viola",
                "Veinte de Julio",
                "Veintitrés de Noviembre",
                "Villa Adela I",
                "Villa Adela II",
                "Villa Angelita",
                "Villa Anita",
                "Villa Carmen I",
                "Villa Carmen II",
                "Villa Cecilia",
                "Villa de Aragón",
                "Villa Del Carmen",
                "Villa Del Rey",
                "Villa Estadio I",
                "Villa Estadio II",
                "Villa Estefany",
                "Villa Esther",
                "Villa Gladis",
                "Villa Karla I",
                "Villa Katanga I",
                "Villa Katanga II",
                "Villa Las Moras I",
                "Villa Las Moras II",
                "Villa Lozano",
                "Villa María",
                "Villa María Silena",
                "Villa Merly",
                "Villa Mónica",
                "Villa Murillo",
                "Villa Rosa",
                "Villa Salamar",
                "Villa Santa",
                "Villa Severa",
                "Villa Sevilla",
                "Villa Sofía",
                "Villa Sol",
                "Villa Soledad",
                "Villa Valentina",
                "Villa Zambrano",
                "Viñas del Rey",
                "Vista Hermosa",
                "Zarabanda"
            ]
        }
    };

    // Cargar barrios según ciudad seleccionada
    function cargarBarrios() {
        const ciudadSelect = document.getElementById('ciudad');
        const barrioSelect = document.getElementById('barrio');
        const ciudad = ciudadSelect.value;
        
        barrioSelect.innerHTML = '<option value="">Seleccionar barrio</option>';
        barrioSelect.disabled = !ciudad;
        
        if (ciudad) {
            const barriosData = barriosPorCiudad[ciudad];
            for (const [localidad, barrios] of Object.entries(barriosData)) {
                const optgroup = document.createElement('optgroup');
                optgroup.label = localidad;
                
                barrios.forEach(barrio => {
                    const option = document.createElement('option');
                    option.value = barrio;
                    option.textContent = barrio;
                    optgroup.appendChild(option);
                });
                
                barrioSelect.appendChild(optgroup);
            }
            
            // Validar automáticamente
            validarCampo(ciudadSelect);
        }
    }

    // Modificar la función guardarDatosPaso para incluir los nuevos campos
    function guardarDatosPaso() {
        const paso = document.getElementById(`paso${pasoActual}`);
        const inputs = paso.querySelectorAll('input, select, textarea');
        
        inputs.forEach(input => {
            if (input.type === 'checkbox') {
                datosEstudiante[input.id] = input.checked;
            } else {
                datosEstudiante[input.id] = input.value;
            }
        });
        
        // Guardar también el nombre completo del tipo de documento y género
        if (pasoActual === 1) {
            const tipoDocSelect = document.getElementById('tipo_documento');
            const generoSelect = document.getElementById('genero');
            
            datosEstudiante['tipo_documento_texto'] = tipoDocSelect.options[tipoDocSelect.selectedIndex].text;
            datosEstudiante['genero_texto'] = generoSelect.options[generoSelect.selectedIndex].text;
            
            // Calcular y guardar edad
            if (datosEstudiante['fecha_nacimiento']) {
                const edad = document.getElementById('edad-calculada').textContent;
                datosEstudiante['edad'] = edad !== '--' ? parseInt(edad) : null;
            }
        }
    }

    // Configurar el formulario
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar variables
        let pasoActual = 1;
        const totalPasos = 3;
        const datosEstudiante = {};
        
        // Configurar validaciones
        configurarValidaciones();
    });

    // Configurar validaciones especiales
    function configurarValidaciones() {
        // Validación de fecha de nacimiento y cálculo de edad
        document.getElementById('fecha_nacimiento').addEventListener('change', function() {
            if (!this.value) {
                document.getElementById('edad-calculada').textContent = '--';
                return;
            }

            const fechaNacimiento = new Date(this.value + 'T00:00:00'); // Agregar hora para evitar problemas de timezone
            const hoy = new Date();
            
            // Calcular edad de forma más precisa
            let edad = hoy.getFullYear() - fechaNacimiento.getFullYear();
            const mesActual = hoy.getMonth();
            const mesNacimiento = fechaNacimiento.getMonth();
            const diaActual = hoy.getDate();
            const diaNacimiento = fechaNacimiento.getDate();
            
            // Ajustar si aún no ha cumplido años este año
            if (mesActual < mesNacimiento || (mesActual === mesNacimiento && diaActual < diaNacimiento)) {
                edad--;
            }
            
            // Mostrar la edad calculada
            document.getElementById('edad-calculada').textContent = edad;
            
            const container = this.closest('.input-with-validation');
            const icon = container?.querySelector('.validation-icon');
            
            // Validar rango de edad razonable
            if (edad < 4 || edad > 25) {
                this.classList.add('is-invalid');
                this.classList.remove('is-valid');
                if (icon) {
                    icon.innerHTML = '✕';
                    icon.className = 'validation-icon error';
                }
                showNotification('La edad debe estar entre 4 y 25 años', 'warning');
            } else if (edad >= 4 && edad <= 25) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
                if (icon) {
                    icon.innerHTML = '✓';
                    icon.className = 'validation-icon success';
                }
            } else {
                // Edad válida pero fuera del contexto escolar típico
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
                if (icon) {
                    icon.innerHTML = '✓';
                    icon.className = 'validation-icon success';
                }
            }
        });

        // Validación de documento único
        document.getElementById('documento').addEventListener('blur', function() {
            const documento = this.value;
            if (documento) {
                verificarDocumentoUnico(documento);
            }
        });

        // Validación de número en documento
        document.getElementById('documento').addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '');
            if (this.value.length > 15) {
                this.value = this.value.slice(0, 15);
            }
        });

        // Validación de teléfono
        document.getElementById('telefono').addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '');
            if (this.value.length > 15) {
                this.value = this.value.slice(0, 15);
            }
        });

        document.getElementById('contacto_emergencia').addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '');
            if (this.value.length > 15) {
                this.value = this.value.slice(0, 15);
            }
        });

        // Validación de promedio
        document.getElementById('promedio_anterior').addEventListener('input', function() {
            const valor = parseFloat(this.value);
            const container = this.closest('.input-with-validation');
            const icon = container?.querySelector('.validation-icon');
            
            if (valor < 1 || valor > 5) {
                this.classList.add('is-invalid');
                this.classList.remove('is-valid');
                if (icon) {
                    icon.innerHTML = '✕';
                    icon.className = 'validation-icon error';
                }
            } else {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
                if (icon) {
                    icon.innerHTML = '✓';
                    icon.className = 'validation-icon success';
                }
            }
        });

        // Validación en tiempo real para todos los campos
        document.querySelectorAll('input, select, textarea').forEach(input => {
            input.addEventListener('input', function() {
                validarCampo(this);
            });
            
            input.addEventListener('blur', function() {
                validarCampo(this);
            });
        });
    }

    // Función para validar un campo individual
    function validarCampo(input) {
        const container = input.closest('.input-with-validation');
        if (!container) return;
        
        const icon = container.querySelector('.validation-icon');
        
        // Validaciones básicas
        let esValido = true;
        
        if (input.hasAttribute('required') && !input.value.trim()) {
            esValido = false;
        }
        
        if (input.type === 'email' && input.value) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(input.value)) {
                esValido = false;
            }
        }
        
        if (input.type === 'tel' && input.value) {
            if (input.value.length < 7) {
                esValido = false;
            }
        }
        
        // Aplicar estilos de validación
        if (esValido && input.value.trim()) {
            input.classList.remove('is-invalid');
            input.classList.add('is-valid');
            if (icon) {
                icon.innerHTML = '✓';
                icon.className = 'validation-icon success';
            }
        } else if (!esValido) {
            input.classList.add('is-invalid');
            input.classList.remove('is-valid');
            if (icon) {
                icon.innerHTML = '✕';
                icon.className = 'validation-icon error';
            }
        } else {
            input.classList.remove('is-invalid', 'is-valid');
            if (icon) {
                icon.innerHTML = '';
                icon.className = 'validation-icon';
            }
        }
    }

    // Verificar documento único
    async function verificarDocumentoUnico(documento) {
        try {
            const response = await fetch(`/admin/api/verificar-documento/${documento}`);
            const data = await response.json();
            
            const alertElement = document.getElementById('documento-exists');
            const input = document.getElementById('documento');
            const container = input.closest('.input-with-validation');
            const icon = container?.querySelector('.validation-icon');
            
            if (data.exists) {
                alertElement.style.display = 'block';
                input.classList.add('is-invalid');
                input.classList.remove('is-valid');
                if (icon) {
                    icon.innerHTML = '✕';
                    icon.className = 'validation-icon error';
                }
                return false;
            } else {
                alertElement.style.display = 'none';
                input.classList.remove('is-invalid');
                input.classList.add('is-valid');
                if (icon) {
                    icon.innerHTML = '✓';
                    icon.className = 'validation-icon success';
                }
                return true;
            }
        } catch (error) {
            console.error('Error verificando documento:', error);
            return true; // Permitir continuar si hay error en la verificación
        }
    }

    // Cargar acudientes
    async function cargarAcudientes() {
        try {
            const response = await fetch('/admin/api/acudientes');
            if (response.ok) {
                const acudientes = await response.json();
                const select = document.getElementById('acudiente');
                
                select.innerHTML = '<option value="">Seleccionar acudiente</option>';
                acudientes.forEach(acudiente => {
                    select.innerHTML += `
                        <option value="${acudiente.id}">
                            ${acudiente.nombres} ${acudiente.apellidos} - ${acudiente.documento}
                        </option>
                    `;
                });
            }
        } catch (error) {
            console.error('Error cargando acudientes:', error);
        }
    }

    // Abrir modal de acudiente
    function abrirModalAcudiente() {
        const modal = new bootstrap.Modal(document.getElementById('modalAcudiente'));
        modal.show();
    }

    // Guardar nuevo acudiente
    async function guardarAcudiente() {
        const form = document.getElementById('form-acudiente');
        
        // Validar campos requeridos
        const campos = ['acudiente_nombres', 'acudiente_apellidos', 'acudiente_documento', 'acudiente_telefono'];
        let valido = true;
        
        campos.forEach(campo => {
            const input = document.getElementById(campo);
            if (!input.value.trim()) {
                input.classList.add('is-invalid');
                valido = false;
            } else {
                input.classList.remove('is-invalid');
                input.classList.add('is-valid');
            }
        });

        if (!valido) {
            showNotification('Por favor complete todos los campos obligatorios', 'warning');
            return;
        }

        try {
            const acudienteData = {
                nombres: document.getElementById('acudiente_nombres').value,
                apellidos: document.getElementById('acudiente_apellidos').value,
                documento: document.getElementById('acudiente_documento').value,
                telefono: document.getElementById('acudiente_telefono').value,
                email: document.getElementById('acudiente_email').value
            };

            const response = await fetch('/admin/api/acudientes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(acudienteData)
            });

            if (response.ok) {
                const nuevoAcudiente = await response.json();
                
                // Agregar al select
                const select = document.getElementById('acudiente');
                const option = document.createElement('option');
                option.value = nuevoAcudiente.id;
                option.textContent = `${nuevoAcudiente.nombres} ${nuevoAcudiente.apellidos} - ${nuevoAcudiente.documento}`;
                option.selected = true;
                select.appendChild(option);

                // Cerrar modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('modalAcudiente'));
                modal.hide();

                // Limpiar formulario
                form.reset();
                
                showNotification('Acudiente registrado correctamente', 'success');
            } else {
                throw new Error('Error al guardar acudiente');
            }
        } catch (error) {
            console.error('Error:', error);
            showNotification('Error al guardar el acudiente', 'error');
        }
    }

    // Manejar envío del formulario principal
    document.getElementById('nuevo-estudiante-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        if (!validarPasoActual()) {
            return;
        }

        // Guardar datos del último paso
        guardarDatosPaso();

        // Validar datos completos
        if (!validarDatosCompletos()) {
            showNotification('Por favor complete todos los campos obligatorios', 'warning');
            return;
        }

        // Mostrar loading en el botón
        const btnRegistrar = document.getElementById('btnRegistrar');
        const textoOriginal = btnRegistrar.innerHTML;
        btnRegistrar.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Registrando...';
        btnRegistrar.disabled = true;

        try {
            const response = await fetch('/admin/api/estudiantes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(datosEstudiante)
            });

            if (response.ok) {
                const resultado = await response.json();
                showNotification('Estudiante registrado correctamente', 'success');
                
                // Preguntar si desea registrar otro estudiante
                setTimeout(() => {
                    if (confirm('¿Desea registrar otro estudiante?')) {
                        location.reload();
                    } else {
                        window.location.href = '/admin/estudiantes';
                    }
                }, 1500);
            } else {
                const error = await response.json();
                throw new Error(error.message || 'Error al registrar estudiante');
            }
        } catch (error) {
            console.error('Error:', error);
            showNotification(error.message || 'Error al registrar el estudiante', 'error');
        } finally {
            // Restaurar botón
            btnRegistrar.innerHTML = textoOriginal;
            btnRegistrar.disabled = false;
        }
    });

    // Validar datos completos
    function validarDatosCompletos() {
        const camposObligatorios = [
            'nombres', 'apellidos', 'tipo_documento', 'documento', 
            'fecha_nacimiento', 'genero', 'grado', 'seccion', 'fecha_ingreso'
        ];

        return camposObligatorios.every(campo => {
            const valor = datosEstudiante[campo];
            return valor && valor.toString().trim() !== '';
        });
    }

    // Función para capitalizar nombres
    function capitalizarTexto(input) {
        input.addEventListener('blur', function() {
            this.value = this.value.toLowerCase().replace(/\b\w/g, l => l.toUpperCase());
        });
    }

    // Aplicar capitalización a campos de nombres
    capitalizarTexto(document.getElementById('nombres'));
    capitalizarTexto(document.getElementById('apellidos'));
    capitalizarTexto(document.getElementById('institucion_anterior'));

    // Formateo de teléfonos
    function formatearTelefono(input) {
        input.addEventListener('input', function() {
            let valor = this.value.replace(/\D/g, '');
            
            if (valor.length <= 10) {
                // Formato: 300 123 4567
                if (valor.length > 6) {
                    valor = valor.replace(/(\d{3})(\d{3})(\d{4})/, '$1 $2 $3');
                } else if (valor.length > 3) {
                    valor = valor.replace(/(\d{3})(\d{3})/, '$1 $2');
                }
            }
            
            this.value = valor;
        });
    }

    // Aplicar formato a campos de teléfono
    formatearTelefono(document.getElementById('telefono'));
    formatearTelefono(document.getElementById('contacto_emergencia'));
    formatearTelefono(document.getElementById('acudiente_telefono'));

    // Agregar validación de año para fecha de nacimiento
    document.getElementById('fecha_nacimiento').addEventListener('input', limitarAnio);

    // Atajos de teclado
    document.addEventListener('keydown', function(e) {
        // Ctrl + Enter para siguiente paso o guardar
        if (e.ctrlKey && e.key === 'Enter') {
            e.preventDefault();
            if (pasoActual < totalPasos) {
                pasoSiguiente();
            } else {
                document.getElementById('nuevo-estudiante-form').dispatchEvent(new Event('submit'));
            }
        }
        
        // Escape para paso anterior
        if (e.key === 'Escape' && pasoActual > 1) {
            e.preventDefault();
            pasoAnterior();
        }
    });

    // Función showNotification (placeholder - debes implementar según tu sistema)
    function showNotification(message, type) {
        console.log(`${type.toUpperCase()}: ${message}`);
        // Aquí implementarías tu sistema de notificaciones
    }
</script>

<style>
    /* Variables CSS personalizadas */
    :root {
        --primary-color: #3b82f6;
        --success-color: #10b981;
        --danger-color: #ef4444;
        --warning-color: #f59e0b;
        --info-color: #06b6d4;
        --light-bg: #f8fafc;
        --border-radius: 12px;
        --border-color: #e2e8f0;
        --success-border: #10b981;
        --danger-border: #ef4444;
        --text-muted: #64748b;
    }

    /* Reset y base */
    .paso-form {
        min-height: 400px;
        background: #f8fafc;
        padding: 2rem;
        border-radius: var(--border-radius);
    }

    .progress {
        background-color: rgba(59, 130, 246, 0.1);
        border-radius: 10px;
    }

    .progress-bar {
        background: linear-gradient(90deg, #3b82f6, #1d4ed8);
        transition: width 0.6s ease;
        border-radius: 10px;
    }

    /* Header con gradiente */
    .form-header-section {
        background: linear-gradient(135deg, #3b82f6, #1e40af);
        color: white;
        padding: 1.5rem 2rem;
        border-radius: var(--border-radius) var(--border-radius) 0 0;
        margin: -2rem -2rem 2rem -2rem;
    }

    .form-header-section h6 {
        margin: 0;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Estilos de labels modernos */
    .form-label {
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .form-label i {
        color: var(--text-muted);
        font-size: 1rem;
    }

    .text-danger {
        color: var(--danger-color) !important;
    }

    /* SOLUCIÓN DEFINITIVA PARA CHECKMARKS */
    
    /* Remover TODOS los background-images automáticos */
    .form-control,
    .form-select {
        background-image: none !important;
        padding-right: 40px;
        border: 2px solid var(--border-color);
        border-radius: var(--border-radius);
        padding: 0.75rem 1rem;
        font-size: 0.875rem;
        transition: all 0.2s ease-in-out;
        background-color: white;
    }
    
    /* Eliminar pseudo-elementos completamente */
    .form-control::after,
    .form-control::before,
    .form-select::after,
    .form-select::before,
    input::after,
    input::before,
    select::after,
    select::before,
    textarea::after,
    textarea::before {
        display: none !important;
        content: none !important;
    }

    /* Estados de focus */
    .form-control:focus,
    .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        outline: none;
        background-color: white;
    }

    /* Contenedor para input con validación */
    .input-with-validation {
        position: relative;
        display: block;
        width: 100%;
    }

    /* Ícono de validación personalizado */
    .validation-icon {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 18px;
        font-weight: bold;
        pointer-events: none;
        z-index: 10;
        display: none;
        width: 20px;
        height: 20px;
        text-align: center;
        line-height: 18px;
    }

    .validation-icon.success {
        color: var(--success-color);
        display: block;
    }

    .validation-icon.error {
        color: var(--danger-color);
        display: block;
    }

    /* Para textarea, ajustar posición del ícono */
    textarea + .validation-icon {
        top: 20px;
        transform: none;
    }

    /* Estados válido/inválido SIN background-image */
    .form-control.is-valid,
    .form-select.is-valid {
        border-color: var(--success-border) !important;
        background-color: white !important;
        box-shadow: none !important;
        background-image: none !important;
    }

    .form-control.is-invalid,
    .form-select.is-invalid {
        border-color: var(--danger-border) !important;
        background-color: white !important;
        box-shadow: none !important;
        background-image: none !important;
    }

    /* Asegurar que NUNCA hay checkmarks automáticos */
    .was-validated .form-control:valid,
    .was-validated .form-select:valid,
    .form-control.is-valid,
    .form-select.is-valid,
    .was-validated .form-control:invalid,
    .was-validated .form-select:invalid,
    .form-control.is-invalid,
    .form-select.is-invalid {
        background-image: none !important;
        background-repeat: no-repeat !important;
        background-position: right calc(0.375em + 0.1875rem) center !important;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem) !important;
    }

    /* Placeholders */
    .form-control::placeholder {
        color: var(--text-muted);
        opacity: 0.7;
    }

    /* Alertas de warning */
    .warning-alert {
        background-color: #fef3c7;
        border: 1px solid #fbbf24;
        color: #92400e;
        padding: 0.75rem 1rem;
        border-radius: var(--border-radius);
        font-size: 0.875rem;
        margin-top: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .warning-alert i {
        color: #f59e0b;
    }

    /* Helper text */
    .form-text {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 0.25rem;
    }

    /* Selects con flecha personalizada */
    .form-select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e") !important;
        background-repeat: no-repeat !important;
        background-position: right 1rem center !important;
        background-size: 16px 12px !important;
        padding-right: 2.5rem !important;
    }

    /* Botones */
    .btn {
        border-radius: var(--border-radius);
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        transition: all 0.2s ease-in-out;
    }

    .btn-primary {
        background: linear-gradient(135deg, #3b82f6, #1e40af);
        border: none;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        transform: translateY(-1px);
        box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
    }

    .btn-success {
        background: linear-gradient(135deg, #10b981, #059669);
        border: none;
    }

    .btn-success:hover {
        background: linear-gradient(135deg, #059669, #047857);
        transform: translateY(-1px);
        box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
    }

    /* Modal styles */
    .modal-content {
        border-radius: var(--border-radius);
        border: none;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    .modal-header {
        border-bottom: 1px solid var(--border-color);
        padding: 1.5rem;
        background: linear-gradient(135deg, #3b82f6, #1e40af);
        color: white;
        border-radius: var(--border-radius) var(--border-radius) 0 0;
    }

    .modal-body {
        padding: 1.5rem;
    }

    .modal-footer {
        border-top: 1px solid var(--border-color);
        padding: 1.5rem;
        background-color: #f8fafc;
        border-radius: 0 0 var(--border-radius) var(--border-radius);
    }

    /* Animaciones */
    .paso-form {
        animation: fadeInUp 0.5s ease-out;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Responsive */
    @media (max-width: 768px) {
        .paso-form {
            min-height: auto;
            padding: 1rem;
        }
        
        .form-header-section {
            margin: -1rem -1rem 1rem -1rem;
            padding: 1rem;
        }
        
        .validation-icon {
            right: 10px;
            font-size: 16px;
        }
    }

    /* Grid mejorado */
    .row {
        margin-left: -0.75rem;
        margin-right: -0.75rem;
    }

    .row > * {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
    }

    .mb-3 {
        margin-bottom: 1.5rem !important;
    }

    /* Estilos para los grupos de opciones en selects */
    optgroup {
        font-weight: 600;
        color: #4b5563;
    }

    optgroup option {
        font-weight: normal;
        padding-left: 1.5rem;
    }

    /* Mejorar el espaciado en los selects */
    select.form-select {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
    }

    /* Estilo para selects deshabilitados */
    select.form-select:disabled {
        background-color: #f3f4f6;
        border-color: #e5e7eb;
        cursor: not-allowed;
    }

    /* Mejorar la visualización de los campos de ubicación */
    .location-fields {
        background-color: #f8fafc;
        padding: 1.5rem;
        border-radius: var(--border-radius);
        margin-bottom: 1.5rem;
        border: 1px solid var(--border-color);
    }

    .location-fields .form-header-section {
        margin: -1.5rem -1.5rem 1.5rem -1.5rem;
    }
</style>
{% endblock %} validación Bootstrap
        const forms = document.querySelectorAll('.needs-validation');
        forms.forEach(form => {
            form.addEventListener('submit', event => {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            });
        });
    }

    // Navegación entre pasos
    function pasoSiguiente() {
        if (validarPasoActual()) {
            guardarDatosPaso();
            
            if (pasoActual < totalPasos) {
                pasoActual++;
                mostrarPaso(pasoActual);
                actualizarProgreso();
            }
        }
    }

    function pasoAnterior() {
        if (pasoActual > 1) {
            pasoActual--;
            mostrarPaso(pasoActual);
            actualizarProgreso();
        }
    }

    // Mostrar paso específico
    function mostrarPaso(paso) {
        // Ocultar todos los pasos
        document.querySelectorAll('.paso-form').forEach(div => {
            div.style.display = 'none';
        });
        
        // Mostrar paso actual
        document.getElementById(`paso${paso}`).style.display = 'block';
        
        // Actualizar botones
        document.getElementById('btnAnterior').style.display = paso > 1 ? 'inline-block' : 'none';
        document.getElementById('btnSiguiente').style.display = paso < totalPasos ? 'inline-block' : 'none';
        document.getElementById('btnRegistrar').style.display = paso === totalPasos ? 'inline-block' : 'none';
    }

    // Actualizar barra de progreso
    function actualizarProgreso() {
        const progreso = (pasoActual / totalPasos) * 100;
        document.getElementById('barraProgreso').style.width = `${progreso}%`;
        document.getElementById('pasoActual').textContent = pasoActual;
        
        // Actualizar etiquetas
        for (let i = 1; i <= totalPasos; i++) {
            const etiqueta = document.getElementById(`etiqueta${i}`);
            if (i <= pasoActual) {
                etiqueta.className = 'text-primary fw-bold';
            } else {
                etiqueta.className = 'text-muted';
            }
        }
    }

    // Validar paso actual
    function validarPasoActual() {
        const paso = document.getElementById(`paso${pasoActual}`);
        const inputs = paso.querySelectorAll('input[required], select[required]');
        let valido = true;

        inputs.forEach(input => {
            const container = input.closest('.input-with-validation');
            const icon = container?.querySelector('.validation-icon');
            
            if (!input.checkValidity()) {
                input.classList.add('is-invalid');
                input.classList.remove('is-valid');
                if (icon) {
                    icon.innerHTML = '✕';
                    icon.className = 'validation-icon error';
                }
                valido = false;
            } else {
                input.classList.remove('is-invalid');
                input.classList.add('is-valid');
                if (icon) {
                    icon.innerHTML = '✓';
                    icon.className = 'validation-icon success';
                }
            }
        });

        if (!valido) {
            showNotification('Por favor complete todos los campos obligatorios', 'warning');
        }

        return valido;
    }

    // Guardar datos del paso actual
    function guardarDatosPaso() {
        const paso = document.getElementById(`paso${pasoActual}`);
        const inputs = paso.querySelectorAll('input, select, textarea');
        
        inputs.forEach(input => {
            if (input.type === 'checkbox') {
                datosEstudiante[input.id] = input.checked;
            } else {
                datosEstudiante[input.id] = input.value;
            }
        });
    }

    // Configurar